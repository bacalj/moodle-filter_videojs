YUI.add("moodle-filter_videojs-transcript",function(e,t){"use_strict";var n;M.filter_videojs=M.filter_videojs||{},n=M.filter_videojs.transcript={},n.init=function(t){typeof n.initialized=="undefined"&&(e.Get.load([t.sources.css_source,t.sources.js_source],function(r){if(r)return;videojs.options.flash.swf=t.sources.swf_source,e.on("domready",function(){n.buildClipMenu()})}),n.initialized="initialized",n.videos=[]);var r=JSON.parse(t.clips);n.videos[r.id]=r},n.buildClipMenu=function(){n.players=e.all(".video-js"),n.players.each(function(t){var r=videojs(t.get("id")),i=e.one(r.contentEl());i.setData("out",""),i.setData("in",0),i.setData("playerID",i._node.id),i.setData("srctypes",""),i.setData("tracks",[]);if(r.techName==="Flash"){alert("The Video.js Flash player does not support all of the Video.js Filter functionality. Please try a different browser.");return}r.ready(function(){this.load()}),r.on("timeupdate",function(){this.currentTime()<i.getData("in")&&this.currentTime(i.getData("in"));if(i.getData("out")==="")return;this.currentTime()>i.getData("out")&&(this.currentTime(i.getData("out")),this.pause())});var s=n.videos[i.getData("playerID")].clips;if(s.length>0){var o=e.Node.create("<ol></ol>");o.addClass("video-js-cliplist");var u=e.one(r.contentEl());u.insert(o,"before"),e.one(r.contentEl()).insert(o,"before");for(var a=0;a<s.length;a++){var f=a+1,l=s[a].clipparams,c=l.label;c===""&&(c="Clip");var h=e.Node.create("<a href='#' class='filter-vjs-cliplink clip"+f+"'>"+c+"</a>");h.setData("params",l),h.setData("playerID",i._node.id),h.setData("clipNumber",f);var p=e.Node.create("<li></li>");p.append(h),o.append(p),a===0&&(i.setData("in",l.in),i.setData("out",l.out),i.setData("srctypes",l.srctypes))}}i.getData("srctypes")!==""&&r.src(i.getData("srctypes"))}),e.on("domready",function(){linkList=e.all(".filter-vjs-cliplink"),linkList.each(function(e){e.on("click",function(e){e.preventDefault(),n.playClip(this)})})})},n.playClip=function(t){var n=t.getData("params"),r=t.getData("playerID"),i=t.getData("clipNumber"),s=".clip"+i,o=t.ancestor("ol");o.all(".filter-vjs-cliplink").setStyle("fontWeight","normal"),o.one(s).setStyle("fontWeight","bold"),o.one(s).blur();var u=videojs(r);vjspNode=e.one(u.contentEl()),vjspNode.setData("in",n.in),vjspNode.setData("out",n.out),u.controlBar.captionsButton.hide();var f=u.controlBar.captionsButton.menu.children().length;for(var l=0;l<f;l++)u.controlBar.captionsButton.menu.children()[l].el().remove();var c=vjspNode.ancestor("div").one(".videojs-transcript-area");c!==null&&c.remove();var h=vjspNode.one(".filter-videojs-captions-div");h!==null&&h.remove();if(n.tracks.length>0){var p=n.tracks[0].params.label,d=new videojs.MenuItem(u,{label:p});d.addClass("captionsOnButton");var v=new videojs.MenuItem(u,{label:p+" off"});d.on(v,"click",function(){this.removeClass("vjs-selected")}),u.controlBar.captionsButton.menu.addChild(v,{}),u.controlBar.captionsButton.menu.addChild(d,{}),u.controlBar.captionsButton.show();var m=n.tracks[0].transcript,g=m.captions,y=e.DOM.create(g),b=vjspNode.one(".vjs-control-bar");b.insert(y,"before");var w=e.Node(y),E=w.all("div");E.each(function(e){var t=e.getAttribute("class"),n=t.match(".*filter-videojs-caption-in-([0-9_]*) "),r=n[1].replace("_","."),i=t.match(".*filter-videojs-caption-out-([0-9_]*)"),s=i[1].replace("_",".");u.on("timeupdate",function(){u.currentTime()>r&&u.currentTime()<s&&d.hasClass("vjs-selected")?e.hasClass("filter-videojs-active-caption")||e.addClass("filter-videojs-active-caption"):e.hasClass("filter-videojs-active-caption")&&e.removeClass("filter-videojs-active-caption")})});var S=m.html;if(n.tracks[0].transatts.transcript==="display"){var x=e.DOM.create(S);vjspNode.insert(x,"after");var T=e.Node(x),N=T.one("table");T.on("mouseenter",function(){T.addClass("hovered")}),T.on("mouseleave",function(){T.removeClass("hovered")});var C=N.all("tr");C.each(function(t){var n=t.getAttribute("class"),r=n.match(".*filter-videojs-in-([0-9_]*) "),i=r[1].replace("_","."),s=n.match(".*filter-videojs-out-([0-9_]*) "),o=s[1].replace("_",".");u.on("timeupdate",function(){if(u.currentTime()>i&&u.currentTime()<o){if(!t.hasClass("filter-videojs-active-cue")){t.addClass("filter-videojs-active-cue");var n=N.getY(),r=t.getY(),s=r-n;a=new e.Anim({node:T,to:{scrollTop:s-80},duration:.3,easing:e.Easing.easeBoth}),T.hasClass("hovered")||a.run()}}else t.hasClass("filter-videojs-active-cue")&&t.removeClass("filter-videojs-active-cue")}),t.on("click",function(){u.currentTime(i)})})}}u.load(),u.ready(function(){u.src(n.srctypes),u.bigPlayButton.hide(),u.controlBar.show(),u.play()})}},"@VERSION@",{requires:["base","node","event","get","node-screen","anim","event-mouseenter"]});
